<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sierra Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #09090b; --bg-card: #18181b; --bg-hover: #27272a; --bg-active: #3f3f46;
            --border: #27272a; --text: #fafafa; --text-muted: #a1a1aa; --text-dim: #71717a;
            --accent: #3b82f6; --green: #22c55e; --yellow: #eab308; --red: #ef4444;
            --purple: #a855f7; --orange: #f97316; --cyan: #06b6d4; --pink: #ec4899;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text); display: flex; min-height: 100vh; }
        
        .sidebar { width: 200px; background: var(--bg-card); border-right: 1px solid var(--border); display: flex; flex-direction: column; position: fixed; height: 100vh; z-index: 100; }
        .logo { padding: 16px 12px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
        .logo-icon { width: 32px; height: 32px; background: linear-gradient(135deg, var(--accent), var(--purple)); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .logo-text { font-weight: 700; font-size: 16px; }
        .logo-sub { font-size: 10px; color: var(--text-dim); }
        .nav { flex: 1; padding: 8px 6px; overflow-y: auto; }
        .nav-section { margin-bottom: 16px; }
        .nav-label { font-size: 9px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); padding: 0 10px; margin-bottom: 4px; }
        .nav-item { display: flex; align-items: center; gap: 8px; padding: 7px 10px; border-radius: 6px; cursor: pointer; color: var(--text-muted); transition: all 0.15s; font-size: 12px; font-weight: 500; }
        .nav-item:hover { background: var(--bg-hover); color: var(--text); }
        .nav-item.active { background: var(--accent); color: white; }
        .nav-icon { font-size: 14px; }
        .nav-badge { margin-left: auto; background: var(--bg-active); padding: 1px 5px; border-radius: 6px; font-size: 9px; }
        .nav-item.active .nav-badge { background: rgba(255,255,255,0.2); }
        .sidebar-footer { padding: 10px; border-top: 1px solid var(--border); font-size: 10px; color: var(--text-dim); }
        .status-dot { display: inline-block; width: 6px; height: 6px; background: var(--green); border-radius: 50%; margin-right: 6px; animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .main { flex: 1; margin-left: 200px; min-height: 100vh; }
        .header { position: sticky; top: 0; background: var(--bg-dark); border-bottom: 1px solid var(--border); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 50; }
        .header-title { font-size: 16px; font-weight: 600; }
        .header-actions { display: flex; align-items: center; gap: 10px; }
        .refresh-btn { display: flex; align-items: center; gap: 5px; background: var(--bg-card); border: 1px solid var(--border); color: var(--text); padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 11px; }
        .refresh-btn:hover { background: var(--bg-hover); }
        .refresh-btn.loading .ri { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .last-update { font-size: 10px; color: var(--text-dim); }
        
        .content { padding: 20px; }
        .page { display: none; }
        .page.active { display: block; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 14px; cursor: pointer; transition: all 0.15s; }
        .stat-card:hover { border-color: var(--text-dim); }
        .stat-label { font-size: 10px; color: var(--text-muted); margin-bottom: 4px; }
        .stat-value { font-size: 24px; font-weight: 700; }
        .stat-value.blue { color: var(--accent); } .stat-value.green { color: var(--green); }
        .stat-value.yellow { color: var(--yellow); } .stat-value.purple { color: var(--purple); }
        .stat-value.orange { color: var(--orange); } .stat-value.cyan { color: var(--cyan); }
        
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        .card-header { padding: 12px 14px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-weight: 600; font-size: 12px; display: flex; align-items: center; gap: 6px; }
        .card-badge { background: var(--bg-hover); padding: 2px 6px; border-radius: 4px; font-size: 10px; color: var(--text-muted); cursor: pointer; }
        .card-body { padding: 10px 14px; max-height: 350px; overflow-y: auto; }
        
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; background: var(--bg-dark); border-radius: 5px; margin-bottom: 5px; border-left: 3px solid var(--accent); cursor: pointer; transition: all 0.15s; }
        .list-item:hover { background: var(--bg-hover); }
        .list-item:last-child { margin-bottom: 0; }
        .list-item.green { border-left-color: var(--green); } .list-item.yellow { border-left-color: var(--yellow); }
        .list-item.purple { border-left-color: var(--purple); } .list-item.orange { border-left-color: var(--orange); }
        .list-item.cyan { border-left-color: var(--cyan); } .list-item.pink { border-left-color: var(--pink); }
        .list-content { flex: 1; }
        .list-title { font-weight: 500; font-size: 12px; margin-bottom: 2px; }
        .list-meta { font-size: 10px; color: var(--text-dim); }
        .status-badge { padding: 2px 6px; border-radius: 3px; font-size: 9px; font-weight: 600; text-transform: uppercase; }
        .status-active { background: rgba(34,197,94,0.15); color: var(--green); }
        .status-dev { background: rgba(59,130,246,0.15); color: var(--accent); }
        .status-pending { background: rgba(234,179,8,0.15); color: var(--yellow); }
        .status-live { background: rgba(34,197,94,0.15); color: var(--green); }
        .status-building { background: rgba(168,85,247,0.15); color: var(--purple); }
        
        .event-item { display: flex; gap: 10px; padding: 8px 10px; background: var(--bg-dark); border-radius: 5px; margin-bottom: 5px; cursor: pointer; border-left: 3px solid var(--accent); }
        .event-item:hover { background: var(--bg-hover); }
        .event-time { font-size: 10px; color: var(--accent); font-weight: 600; min-width: 60px; }
        .event-title { font-size: 12px; font-weight: 500; }
        .event-location { font-size: 10px; color: var(--text-dim); }
        
        .pipeline-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .pipeline-col { background: var(--bg-dark); border-radius: 6px; padding: 10px; }
        .pipeline-header { display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid var(--border); font-size: 11px; font-weight: 600; }
        .pipeline-count { background: var(--bg-hover); padding: 1px 5px; border-radius: 3px; font-size: 9px; }
        .pipeline-item { background: var(--bg-card); padding: 8px; border-radius: 4px; margin-bottom: 5px; cursor: pointer; transition: all 0.15s; }
        .pipeline-item:hover { background: var(--bg-hover); }
        .pipeline-name { font-size: 11px; font-weight: 500; }
        .pipeline-meta { font-size: 9px; color: var(--text-dim); }
        
        .tool-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .tool-item { padding: 10px; background: var(--bg-dark); border-radius: 5px; cursor: pointer; border-left: 3px solid var(--cyan); }
        .tool-item:hover { background: var(--bg-hover); }
        .tool-name { font-size: 12px; font-weight: 500; margin-bottom: 2px; }
        .tool-desc { font-size: 10px; color: var(--text-dim); }
        .tool-cat { font-size: 9px; color: var(--cyan); margin-top: 4px; }
        
        .section-title { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); margin: 16px 0 8px 0; }
        .section-title:first-child { margin-top: 0; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.2s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; width: 90%; max-width: 450px; max-height: 75vh; overflow: hidden; transform: scale(0.95); transition: transform 0.2s; }
        .modal-overlay.active .modal { transform: scale(1); }
        .modal-header { padding: 14px 16px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 14px; font-weight: 600; }
        .modal-close { background: none; border: none; color: var(--text-muted); font-size: 18px; cursor: pointer; }
        .modal-body { padding: 16px; overflow-y: auto; max-height: 55vh; }
        .detail-row { margin-bottom: 12px; }
        .detail-label { font-size: 10px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 3px; }
        .detail-value { font-size: 13px; }
        .tag { display: inline-block; background: var(--bg-hover); padding: 3px 8px; border-radius: 3px; font-size: 10px; margin-right: 4px; margin-bottom: 4px; }
        
        @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(3, 1fr); } .grid-2, .grid-3 { grid-template-columns: 1fr; } .pipeline-grid { grid-template-columns: 1fr; } .tool-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .sidebar { width: 50px; } .logo-text, .logo-sub, .nav-label, .nav-item span:not(.nav-icon), .nav-badge { display: none; } .main { margin-left: 50px; } .stats-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-icon">üèîÔ∏è</div>
            <div><div class="logo-text">Sierra</div><div class="logo-sub">KuriosBrand</div></div>
        </div>
        <nav class="nav">
            <div class="nav-section">
                <div class="nav-label">Main</div>
                <div class="nav-item active" data-page="overview"><span class="nav-icon">üìä</span><span>Overview</span></div>
                <div class="nav-item" data-page="calendar"><span class="nav-icon">üìÖ</span><span>Calendar</span></div>
                <div class="nav-item" data-page="pipeline"><span class="nav-icon">üî•</span><span>Pipeline</span><span class="nav-badge">13</span></div>
            </div>
            <div class="nav-section">
                <div class="nav-label">Business</div>
                <div class="nav-item" data-page="projects"><span class="nav-icon">üìÅ</span><span>Projects</span></div>
                <div class="nav-item" data-page="sites"><span class="nav-icon">üåê</span><span>Sites</span><span class="nav-badge">6</span></div>
                <div class="nav-item" data-page="avatars"><span class="nav-icon">üë§</span><span>Avatars</span></div>
            </div>
            <div class="nav-section">
                <div class="nav-label">System</div>
                <div class="nav-item" data-page="tools"><span class="nav-icon">üîß</span><span>Tools</span><span class="nav-badge">25</span></div>
                <div class="nav-item" data-page="agents"><span class="nav-icon">ü§ñ</span><span>Agents</span></div>
                <div class="nav-item" data-page="integrations"><span class="nav-icon">üîó</span><span>Integrations</span></div>
            </div>
        </nav>
        <div class="sidebar-footer"><span class="status-dot"></span>Online</div>
    </aside>

    <main class="main">
        <header class="header">
            <h1 class="header-title" id="pageTitle">Overview</h1>
            <div class="header-actions">
                <span class="last-update" id="lastUpdate">Updated just now</span>
                <button class="refresh-btn" onclick="refreshData()"><span class="ri">‚Üª</span> Refresh</button>
            </div>
        </header>
        
        <div class="content">
            <!-- OVERVIEW -->
            <div class="page active" id="page-overview">
                <div class="stats-grid">
                    <div class="stat-card" onclick="navigateTo('calendar')"><div class="stat-label">Today's Events</div><div class="stat-value blue" id="stat-events">0</div></div>
                    <div class="stat-card" onclick="navigateTo('pipeline')"><div class="stat-label">Hot Leads</div><div class="stat-value orange" id="stat-hot">7</div></div>
                    <div class="stat-card" onclick="navigateTo('projects')"><div class="stat-label">Projects</div><div class="stat-value purple">5</div></div>
                    <div class="stat-card" onclick="navigateTo('sites')"><div class="stat-label">Sites</div><div class="stat-value cyan">6</div></div>
                    <div class="stat-card" onclick="navigateTo('tools')"><div class="stat-label">Tools</div><div class="stat-value yellow">25</div></div>
                    <div class="stat-card" onclick="navigateTo('integrations')"><div class="stat-label">Integrations</div><div class="stat-value green">11</div></div>
                </div>
                <div class="grid-2">
                    <div class="card"><div class="card-header"><span class="card-title">üìÖ Upcoming</span><span class="card-badge" onclick="navigateTo('calendar')">View All ‚Üí</span></div><div class="card-body" id="overview-calendar">Loading...</div></div>
                    <div class="card"><div class="card-header"><span class="card-title">üî• Hot Leads</span><span class="card-badge" onclick="navigateTo('pipeline')">View All ‚Üí</span></div><div class="card-body" id="overview-hot"></div></div>
                </div>
                <div style="margin-top:14px"><div class="grid-2">
                    <div class="card"><div class="card-header"><span class="card-title">ü§ñ Agents</span></div><div class="card-body" id="overview-agents"></div></div>
                    <div class="card"><div class="card-header"><span class="card-title">üìç Focus</span></div><div class="card-body">
                        <div class="list-item"><div class="list-content"><div class="list-title">Primary Goal</div><div class="list-meta">MVA Lead Gen ‚Äî Client Acquisition</div></div></div>
                        <div class="list-item"><div class="list-content"><div class="list-title">Pricing</div><div class="list-meta">$250-350/lead ‚Ä¢ ~$2,000/signed case</div></div></div>
                        <div class="list-item"><div class="list-content"><div class="list-title">Partners</div><div class="list-meta">Cases on Demand ‚Ä¢ Inquired Esquire</div></div></div>
                    </div></div>
                </div></div>
            </div>

            <!-- CALENDAR -->
            <div class="page" id="page-calendar">
                <div class="card"><div class="card-header"><span class="card-title">üìÖ mark@kuriosbrand.com</span><span class="card-badge" id="cal-count">0 events</span></div><div class="card-body" id="calendar-events" style="max-height:none">Loading...</div></div>
            </div>

            <!-- PIPELINE -->
            <div class="page" id="page-pipeline">
                <div class="pipeline-grid" id="pipeline-grid"></div>
            </div>

            <!-- PROJECTS -->
            <div class="page" id="page-projects">
                <div class="card"><div class="card-header"><span class="card-title">üìÅ Core Projects</span></div><div class="card-body" id="projects-list"></div></div>
            </div>

            <!-- SITES -->
            <div class="page" id="page-sites">
                <div class="card"><div class="card-header"><span class="card-title">üåê Websites</span><span class="card-badge">6 sites</span></div><div class="card-body" id="sites-list"></div></div>
            </div>

            <!-- AVATARS -->
            <div class="page" id="page-avatars">
                <div class="section-title">üèÜ Ranked Avatars (by close rate)</div>
                <div class="grid-2" id="avatars-ranked"></div>
                <div class="section-title">üìã Consolidated Categories</div>
                <div class="grid-2" id="avatars-categories"></div>
            </div>

            <!-- TOOLS -->
            <div class="page" id="page-tools">
                <div class="section-title">üîç Scrapers</div>
                <div class="tool-grid" id="tools-scrapers"></div>
                <div class="section-title">üéôÔ∏è Transcribers</div>
                <div class="tool-grid" id="tools-transcribers"></div>
                <div class="section-title">üîå API Tools</div>
                <div class="tool-grid" id="tools-apis"></div>
                <div class="section-title">‚öôÔ∏è Automation</div>
                <div class="tool-grid" id="tools-automation"></div>
            </div>

            <!-- AGENTS -->
            <div class="page" id="page-agents">
                <div class="card" style="max-width:500px"><div class="card-header"><span class="card-title">ü§ñ Active Agents</span></div><div class="card-body" id="agents-list"></div></div>
            </div>

            <!-- INTEGRATIONS -->
            <div class="page" id="page-integrations">
                <div class="section-title">‚úÖ Connected</div>
                <div class="grid-2" id="integrations-connected"></div>
                <div class="section-title">‚ö†Ô∏è Needs Setup</div>
                <div class="grid-2" id="integrations-pending"></div>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="modal" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header"><span class="modal-title" id="modal-title">Details</span><button class="modal-close" onclick="closeModal()">&times;</button></div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <script>
        let data = {}, calData = {}, lastRefresh = Date.now();
        const pageTitles = {overview:'Overview',calendar:'Calendar',pipeline:'Sales Pipeline',projects:'Projects',sites:'Sites',avatars:'Customer Avatars',tools:'Tools',agents:'Agents',integrations:'Integrations'};
        
        document.querySelectorAll('.nav-item').forEach(i => i.addEventListener('click', () => navigateTo(i.dataset.page)));
        function navigateTo(p) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.querySelector(`[data-page="${p}"]`).classList.add('active');
            document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active'));
            document.getElementById('page-' + p).classList.add('active');
            document.getElementById('pageTitle').textContent = pageTitles[p];
        }
        
        function showModal(t, c) { document.getElementById('modal-title').textContent = t; document.getElementById('modal-body').innerHTML = c; document.getElementById('modal').classList.add('active'); }
        function closeModal(e) { if (!e || e.target.id === 'modal') document.getElementById('modal').classList.remove('active'); }
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
        
        async function refreshData() {
            document.querySelector('.refresh-btn').classList.add('loading');
            try {
                const [d, c] = await Promise.all([fetch('dashboard-data.json?t='+Date.now()), fetch('calendar-data.json?t='+Date.now())]);
                if (d.ok) { data = await d.json(); render(); }
                if (c.ok) { calData = await c.json(); renderCal(); }
                lastRefresh = Date.now();
            } catch(e) { console.log('Refresh failed', e); }
            setTimeout(() => document.querySelector('.refresh-btn').classList.remove('loading'), 500);
        }
        
        function updateTime() {
            const s = Math.floor((Date.now() - lastRefresh) / 1000);
            document.getElementById('lastUpdate').textContent = s < 5 ? 'Updated just now' : s < 60 ? `Updated ${s}s ago` : `Updated ${Math.floor(s/60)}m ago`;
        }
        
        function render() {
            if (!data.pipeline) return;
            // Hot leads
            const hot = data.pipeline.hot || [];
            document.getElementById('stat-hot').textContent = hot.length;
            document.getElementById('overview-hot').innerHTML = hot.slice(0,4).map(l => `<div class="list-item orange" onclick="showLead(${esc(l)})"><div class="list-content"><div class="list-title">${l.name}</div><div class="list-meta">${l.notes||l.nextAction||''}</div></div></div>`).join('');
            
            // Pipeline
            const p = data.pipeline;
            document.getElementById('pipeline-grid').innerHTML = `
                <div class="pipeline-col"><div class="pipeline-header"><span>üî¥ Hot</span><span class="pipeline-count">${(p.hot||[]).length}</span></div>${(p.hot||[]).map(l=>`<div class="pipeline-item" onclick="showLead(${esc(l)})"><div class="pipeline-name">${l.name}${l.company?' ‚Äî '+l.company:''}</div><div class="pipeline-meta">${l.priority==='high'?'‚ö†Ô∏è ':''} ${l.notes||''}</div></div>`).join('')}</div>
                <div class="pipeline-col"><div class="pipeline-header"><span>üü° In Progress</span><span class="pipeline-count">${(p.inProgress||[]).length}</span></div>${(p.inProgress||[]).map(l=>`<div class="pipeline-item" onclick="showLead(${esc(l)})"><div class="pipeline-name">${l.name}${l.company?' ‚Äî '+l.company:''}</div><div class="pipeline-meta">${l.notes||''}</div></div>`).join('')}</div>
                <div class="pipeline-col"><div class="pipeline-header"><span>‚úÖ Closed</span><span class="pipeline-count">${(p.closed||[]).length}</span></div>${(p.closed||[]).map(l=>`<div class="pipeline-item" onclick="showLead(${esc(l)})"><div class="pipeline-name">${l.name}${l.company?' ‚Äî '+l.company:''}</div><div class="pipeline-meta">‚úÖ ${l.value||'CLOSED'}</div></div>`).join('')}</div>`;
            
            // Projects
            const proj = data.projects?.core || [];
            document.getElementById('projects-list').innerHTML = proj.map(p => `<div class="list-item purple" onclick="showProject(${esc(p)})"><div class="list-content"><div class="list-title">${p.name}</div><div class="list-meta">${p.description||''}</div></div><span class="status-badge status-${p.status}">${p.status}</span></div>`).join('');
            
            // Sites
            const sites = data.projects?.sites || [];
            document.getElementById('sites-list').innerHTML = sites.map(s => `<div class="list-item cyan" onclick="showSite(${esc(s)})"><div class="list-content"><div class="list-title">${s.name}</div><div class="list-meta">${s.url||s.purpose||''}</div></div><span class="status-badge status-${s.status}">${s.status}</span></div>`).join('');
            
            // Agents
            const agents = data.projects?.agents || [];
            document.getElementById('overview-agents').innerHTML = agents.map(a => `<div class="list-item green" onclick="showAgent(${esc(a)})"><div class="list-content"><div class="list-title">${a.emoji} ${a.name}</div><div class="list-meta">${a.model} ‚Ä¢ ${a.role}</div></div><span class="status-badge status-active">Online</span></div>`).join('');
            document.getElementById('agents-list').innerHTML = agents.map(a => `<div class="list-item green" onclick="showAgent(${esc(a)})"><div class="list-content"><div class="list-title">${a.emoji} ${a.name}</div><div class="list-meta">${a.model} ‚Ä¢ ${a.telegram}</div></div><span class="status-badge status-active">Online</span></div>`).join('');
            
            // Tools
            const tools = data.tools || {};
            document.getElementById('tools-scrapers').innerHTML = (tools.scrapers||[]).map(t => `<div class="tool-item" onclick="showTool(${esc(t)})"><div class="tool-name">${t.name}</div><div class="tool-desc">${t.path?.split('/').pop()||''}</div></div>`).join('');
            document.getElementById('tools-transcribers').innerHTML = (tools.transcribers||[]).map(t => `<div class="tool-item" onclick="showTool(${esc(t)})"><div class="tool-name">${t.name}</div><div class="tool-desc">${t.usage||''}</div></div>`).join('');
            document.getElementById('tools-apis').innerHTML = (tools.apis||[]).map(t => `<div class="tool-item" onclick="showTool(${esc(t)})"><div class="tool-name">${t.name}</div><div class="tool-desc">${t.account||t.calendar||t.usage||''}</div></div>`).join('');
            document.getElementById('tools-automation').innerHTML = (tools.automation||[]).map(t => `<div class="tool-item" onclick="showTool(${esc(t)})"><div class="tool-name">${t.name}</div><div class="tool-desc">${t.telegram||t.path?.split('/').pop()||''}</div></div>`).join('');
            
            // Integrations
            const int = data.integrations || {};
            document.getElementById('integrations-connected').innerHTML = (int.connected||[]).map(i => `<div class="list-item green"><div class="list-content"><div class="list-title">${i.name}</div><div class="list-meta">${i.account||i.calendar||i.workspace||i.profile||''}</div></div><span class="status-badge status-active">Connected</span></div>`).join('');
            document.getElementById('integrations-pending').innerHTML = (int.needsSetup||[]).map(i => `<div class="list-item yellow"><div class="list-content"><div class="list-title">${i.name}</div><div class="list-meta">${i.note||'Needs configuration'}</div></div><span class="status-badge status-pending">Setup</span></div>`).join('');
            
            // Avatars (from automation data if available)
            renderAvatars();
        }
        
        function renderAvatars() {
            const ranked = [
                {name:'Fast Scaler',score:89,desc:'Small/mid firms, aggressive expansion, $20-50k budget, 100% close rate'},
                {name:'Sophisticated Buyer',score:52,desc:'Mid/large firms, committee decisions, $30-100k budget'},
                {name:'Burned Veteran',score:48,desc:'Wasted $100-250k on failed marketing, needs guarantees'},
                {name:'Solo Transitioner',score:40,desc:'Solo practitioners transitioning, $15-25k budget'}
            ];
            const categories = [
                {name:'Intake-Needy',desc:'Need Patrick\'s intake service ($100/transfer)'},
                {name:'Transparency Seeker',desc:'Want control and contractual guarantees'},
                {name:'Channel Strategist',desc:'Multi-vendor firms needing channel isolation'},
                {name:'Compliance/Quality-Focused',desc:'Risk-averse, $30-50k+ budgets'}
            ];
            document.getElementById('avatars-ranked').innerHTML = ranked.map((a,i) => `<div class="list-item ${['green','purple','orange','yellow'][i]}" onclick="showAvatar(${esc(a)})"><div class="list-content"><div class="list-title">#${i+1} ${a.name} <span style="color:var(--text-dim)">(${a.score}/100)</span></div><div class="list-meta">${a.desc}</div></div></div>`).join('');
            document.getElementById('avatars-categories').innerHTML = categories.map(a => `<div class="list-item cyan" onclick="showAvatar(${esc(a)})"><div class="list-content"><div class="list-title">${a.name}</div><div class="list-meta">${a.desc}</div></div></div>`).join('');
        }
        
        function renderCal() {
            const events = calData.events || [];
            document.getElementById('stat-events').textContent = events.filter(e => isToday(e.start)).length;
            document.getElementById('cal-count').textContent = events.length + ' events';
            
            const grouped = {};
            events.forEach(e => { const d = new Date(e.start).toDateString(); (grouped[d] = grouped[d]||[]).push(e); });
            
            let html = '';
            for (const [d, evts] of Object.entries(grouped)) {
                html += `<div style="font-size:11px;font-weight:600;color:var(--accent);margin:12px 0 6px">${fmtDateHeader(d)}</div>`;
                html += evts.map(e => `<div class="event-item" onclick="showEvent(${esc(e)})"><div class="event-time">${fmtTime(e.start)}</div><div><div class="event-title">${e.title}</div>${e.location?`<div class="event-location">üìç ${e.location}</div>`:''}</div></div>`).join('');
            }
            document.getElementById('calendar-events').innerHTML = html || '<div style="color:var(--text-dim)">No upcoming events</div>';
            document.getElementById('overview-calendar').innerHTML = events.slice(0,3).map(e => `<div class="event-item" onclick="showEvent(${esc(e)})"><div class="event-time">${fmtTime(e.start)}</div><div><div class="event-title">${e.title}</div></div></div>`).join('') || '<div style="color:var(--text-dim)">No events</div>';
        }
        
        function showLead(l) { showModal('üî• '+l.name, `<div class="detail-row"><div class="detail-label">Name</div><div class="detail-value" style="font-size:16px;font-weight:600">${l.name}</div></div>${l.company?`<div class="detail-row"><div class="detail-label">Company</div><div class="detail-value">${l.company}</div></div>`:''}${l.location?`<div class="detail-row"><div class="detail-label">Location</div><div class="detail-value">üìç ${l.location}</div></div>`:''}${l.budget?`<div class="detail-row"><div class="detail-label">Budget</div><div class="detail-value">${l.budget}</div></div>`:''}${l.notes?`<div class="detail-row"><div class="detail-label">Notes</div><div class="detail-value">${l.notes}</div></div>`:''}${l.nextAction?`<div class="detail-row"><div class="detail-label">Next Action</div><div class="detail-value" style="color:var(--orange)">‚Üí ${l.nextAction}</div></div>`:''}`); }
        function showProject(p) { showModal('üìÅ '+p.name, `<div class="detail-row"><div class="detail-label">Status</div><div class="detail-value"><span class="status-badge status-${p.status}">${p.status}</span></div></div><div class="detail-row"><div class="detail-label">Description</div><div class="detail-value">${p.description||''}</div></div>${p.partners?`<div class="detail-row"><div class="detail-label">Partners</div><div class="detail-value">${p.partners.map(x=>`<span class="tag">${x}</span>`).join('')}</div></div>`:''}${p.domain?`<div class="detail-row"><div class="detail-label">Domain</div><div class="detail-value">${p.domain}</div></div>`:''}`); }
        function showSite(s) { showModal('üåê '+s.name, `<div class="detail-row"><div class="detail-label">Status</div><div class="detail-value"><span class="status-badge status-${s.status}">${s.status}</span></div></div>${s.url?`<div class="detail-row"><div class="detail-label">URL</div><div class="detail-value"><a href="${s.url.startsWith('http')?s.url:'https://'+s.url}" target="_blank" style="color:var(--accent)">${s.url}</a></div></div>`:''}${s.stack?`<div class="detail-row"><div class="detail-label">Stack</div><div class="detail-value">${s.stack}</div></div>`:''}${s.purpose?`<div class="detail-row"><div class="detail-label">Purpose</div><div class="detail-value">${s.purpose}</div></div>`:''}${s.features?`<div class="detail-row"><div class="detail-label">Features</div><div class="detail-value">${s.features.map(f=>`<span class="tag">${f}</span>`).join('')}</div></div>`:''}`); }
        function showAgent(a) { showModal(a.emoji+' '+a.name, `<div class="detail-row"><div class="detail-label">Status</div><div class="detail-value"><span class="status-badge status-active">Online</span></div></div><div class="detail-row"><div class="detail-label">Model</div><div class="detail-value">${a.model}</div></div><div class="detail-row"><div class="detail-label">Role</div><div class="detail-value">${a.role}</div></div><div class="detail-row"><div class="detail-label">Telegram</div><div class="detail-value">${a.telegram}</div></div>${a.path?`<div class="detail-row"><div class="detail-label">Path</div><div class="detail-value" style="font-family:monospace;font-size:11px">${a.path}</div></div>`:''}`); }
        function showTool(t) { showModal('üîß '+t.name, `<div class="detail-row"><div class="detail-label">Path</div><div class="detail-value" style="font-family:monospace;font-size:11px">${t.path||'N/A'}</div></div>${t.usage?`<div class="detail-row"><div class="detail-label">Usage</div><div class="detail-value" style="font-family:monospace;font-size:11px">${t.usage}</div></div>`:''}${t.account?`<div class="detail-row"><div class="detail-label">Account</div><div class="detail-value">${t.account}</div></div>`:''}${t.capabilities?`<div class="detail-row"><div class="detail-label">Capabilities</div><div class="detail-value">${t.capabilities.map(c=>`<span class="tag">${c}</span>`).join('')}</div></div>`:''}`); }
        function showEvent(e) { showModal('üìÖ '+e.title, `<div class="detail-row"><div class="detail-label">When</div><div class="detail-value">${fmtDateTime(e.start)}</div></div>${e.location?`<div class="detail-row"><div class="detail-label">Location</div><div class="detail-value">üìç ${e.location}</div></div>`:''}${e.description?`<div class="detail-row"><div class="detail-label">Description</div><div class="detail-value">${e.description}</div></div>`:''}`); }
        function showAvatar(a) { showModal('üë§ '+a.name, `${a.score?`<div class="detail-row"><div class="detail-label">Score</div><div class="detail-value" style="font-size:20px;font-weight:700">${a.score}/100</div></div>`:''}<div class="detail-row"><div class="detail-label">Description</div><div class="detail-value">${a.desc}</div></div>`); }
        
        function esc(o) { return JSON.stringify(o).replace(/"/g,'&quot;'); }
        function fmtTime(d) { return new Date(d).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true}); }
        function fmtDateTime(d) { return new Date(d).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'})+' at '+fmtTime(d); }
        function fmtDateHeader(d) { const dt=new Date(d),td=new Date(),tm=new Date(td);tm.setDate(tm.getDate()+1); if(dt.toDateString()===td.toDateString())return'üìÖ Today'; if(dt.toDateString()===tm.toDateString())return'üìÖ Tomorrow'; return dt.toLocaleDateString('en-US',{weekday:'long',month:'short',day:'numeric'}); }
        function isToday(d) { return new Date(d).toDateString()===new Date().toDateString(); }
        
        refreshData();
        setInterval(refreshData, 30000);
        setInterval(updateTime, 5000);
    </script>
</body>
</html>
