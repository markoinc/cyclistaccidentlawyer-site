---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { cities, getCitiesByState, type CityData } from '../../data/cities';
import { states } from '../../data/states';

export function getStaticPaths() {
  return cities.map((city) => ({
    params: { city: city.slug },
    props: { cityData: city },
  }));
}

interface Props {
  cityData: CityData;
}

const { cityData } = Astro.props;

const stateSlug = cityData.stateSlug || cityData.state.toLowerCase().replace(/\s+/g, '-');
const stateData = states.find(s => s.slug === stateSlug);
const stateAbbr = stateData?.abbreviation || cityData.state.substring(0, 2).toUpperCase();

const fullTitle = `${cityData.name}, ${stateAbbr} Bicycle Accident Lawyer`;
const title = fullTitle.length > 60 ? fullTitle.substring(0, 57) + '...' : fullTitle;
const description = `Injured in a cycling accident in ${cityData.name}? Get a free case evaluation. ${cityData.annualCyclistDeaths} cyclist deaths annually. Bike Score: ${cityData.bikeScore}/100.`;

const schemaMarkup = {
  "@context": "https://schema.org",
  "@type": "LegalService",
  "name": `${cityData.name} Bicycle Accident Lawyers`,
  "description": description,
  "url": `https://cyclistaccidentlawyer.com/cities/${cityData.slug}`,
  "areaServed": { "@type": "City", "name": cityData.name },
  "serviceType": ["Bicycle Accident Law", "Personal Injury Law"],
  "priceRange": "Free Consultation"
};

const breadcrumbs = [
  { name: "Home", url: "/" },
  { name: "Cities", url: "/cities" },
  { name: cityData.name, url: `/cities/${cityData.slug}` }
];

const stateCities = getCitiesByState(stateSlug).filter(c => c.slug !== cityData.slug).slice(0, 5);

// Determine risk level based on bike score (lower = more dangerous)
const bikeScoreRisk = cityData.bikeScore < 40 ? 'high' : cityData.bikeScore < 60 ? 'moderate' : 'low';
const riskColors = {
  high: { bg: "bg-red-100", text: "text-red-800", label: "High Risk Zone" },
  moderate: { bg: "bg-yellow-100", text: "text-yellow-800", label: "Moderate Risk" },
  low: { bg: "bg-green-100", text: "text-green-800", label: "Lower Risk" }
};
const riskStyle = riskColors[bikeScoreRisk];
---

<BaseLayout title={title} description={description} schemaMarkup={schemaMarkup} breadcrumbs={breadcrumbs}>
  <section class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white py-16 md:py-24">
    <div class="container-wide">
      <div class="max-w-4xl">
        <div class="flex items-center gap-2 text-gray-400 mb-4">
          <a href="/" class="hover:text-white transition">Home</a>
          <span>/</span>
          <a href="/cities" class="hover:text-white transition">Cities</a>
          <span>/</span>
          <span class="text-white">{cityData.name}</span>
        </div>
        
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold mb-6">
          {cityData.name}, {stateAbbr} Bicycle Accident Lawyer
        </h1>
        
        <p class="text-xl md:text-2xl text-gray-300 mb-8 leading-relaxed">
          Injured while cycling in {cityData.name}? With <strong class="text-primary-400">{cityData.annualCyclistDeaths}</strong> cyclist deaths annually, you need legal representation that understands the unique challenges cyclists face.
        </p>

        <div class="flex flex-wrap gap-4 mb-8">
          <span class={`${riskStyle.bg} ${riskStyle.text} px-4 py-2 rounded-full font-semibold`}>ğŸš¦ {riskStyle.label}</span>
          <span class="bg-gray-700 text-white px-4 py-2 rounded-full">ğŸ“Š Population: {cityData.population}</span>
          <span class="bg-primary-600 text-white px-4 py-2 rounded-full">ğŸš´ Bike Score: {cityData.bikeScore}/100</span>
        </div>
        
        <div id="free-case-review" class="bg-white/10 backdrop-blur-sm rounded-2xl p-8 border border-white/20">
          <h2 class="text-2xl font-bold mb-4 text-primary-400">Free Case Evaluation</h2>
          <form action="https://services.leadconnectorhq.com/hooks/ASHRZ5ZFolSHXM3RyPvk/webhook-trigger/e1d4ee98-7b23-48e1-8f3b-2bf0aff93afc" method="POST" class="space-y-4">
            <input type="hidden" name="city" value={cityData.name} />
            <input type="hidden" name="state" value={cityData.state} />
            <input type="hidden" name="source" value={`cyclistaccidentlawyer.com/cities/${cityData.slug}`} />
            
            <div class="grid md:grid-cols-2 gap-4">
              <input type="text" name="name" placeholder="Your Name *" required class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/30 text-white placeholder-gray-400" />
              <input type="tel" name="phone" placeholder="Phone Number *" required class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/30 text-white placeholder-gray-400" />
            </div>
            <input type="email" name="email" placeholder="Email Address *" required class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/30 text-white placeholder-gray-400" />
            <textarea name="description" placeholder="Briefly describe your accident..." rows="3" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/30 text-white placeholder-gray-400"></textarea>
            <button type="submit" class="w-full bg-primary-500 hover:bg-primary-600 text-white font-bold py-4 px-8 rounded-lg transition transform hover:scale-105">
              Get Your Free Consultation â†’
            </button>
            <p class="text-sm text-gray-400 text-center">No fees unless we win your case</p>
          </form>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 bg-gray-100">
    <div class="container-wide">
      <h2 class="text-3xl md:text-4xl font-bold mb-8 text-gray-900">âš ï¸ Most Dangerous Areas for Cyclists in {cityData.name}</h2>
      <p class="text-lg text-gray-600 mb-8">These intersections and routes see the highest concentration of cycling accidents. Extra caution is advised.</p>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {cityData.dangerousIntersections.map((intersection, index) => (
          <div class="bg-white rounded-xl p-6 shadow-lg border-l-4 border-red-500">
            <div class="flex items-start gap-4">
              <span class="flex-shrink-0 w-10 h-10 bg-red-100 rounded-full flex items-center justify-center text-red-600 font-bold">{index + 1}</span>
              <div>
                <h3 class="font-semibold text-gray-900">{intersection}</h3>
                <p class="text-sm text-gray-500 mt-1">High accident frequency</p>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <section class="py-16 bg-white">
    <div class="container-wide">
      <h2 class="text-3xl md:text-4xl font-bold mb-8 text-gray-900">ğŸš´ Cycling Infrastructure in {cityData.name}</h2>
      <div class="bg-gradient-to-r from-primary-50 to-blue-50 rounded-xl p-6 border border-primary-200 mb-6">
        <p class="text-gray-800">{cityData.bikeInfrastructure}</p>
      </div>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200">
          <h3 class="font-bold text-gray-900 mb-3">ğŸ›¡ï¸ Protected Lanes</h3>
          <p class="text-gray-700">{cityData.protectedLanes}</p>
        </div>
        <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200">
          <h3 class="font-bold text-gray-900 mb-3">ğŸš² Bike Share</h3>
          <p class="text-gray-700">{cityData.bikeShareSystem}</p>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 bg-gray-900 text-white">
    <div class="container-wide">
      <h2 class="text-3xl md:text-4xl font-bold mb-8">ğŸ“ What Makes {cityData.name} Unique for Cyclists</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {cityData.uniqueFactors.map((factor) => (
          <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
            <p class="text-gray-200">{factor}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <section class="py-16 bg-white">
    <div class="container-wide">
      <h2 class="text-3xl md:text-4xl font-bold mb-8 text-gray-900">âš ï¸ Common Accident Types in {cityData.name}</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
        {cityData.commonAccidentTypes.map((accidentType) => (
          <div class="bg-red-50 rounded-lg p-4 border border-red-200">
            <div class="flex items-center gap-2">
              <span class="text-red-500">âš ï¸</span>
              <span class="font-medium text-gray-800">{accidentType}</span>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <section class="py-16 bg-primary-50">
    <div class="container-wide">
      <h2 class="text-3xl md:text-4xl font-bold mb-8 text-gray-900">âš–ï¸ Local Cycling Laws</h2>
      <div class="bg-white rounded-xl p-6 shadow-lg">
        <p class="text-gray-800 text-lg">{cityData.localLaws}</p>
      </div>
      {stateData && (
        <div class="mt-8 grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          <div class="bg-white rounded-xl p-6 shadow-lg">
            <h3 class="font-bold text-gray-900 mb-2">â±ï¸ Statute of Limitations</h3>
            <p class="text-3xl font-extrabold text-primary-500">{stateData.statuteOfLimitations}</p>
            <p class="text-sm text-gray-500 mt-2">Time limit to file your claim</p>
          </div>
          <div class="bg-white rounded-xl p-6 shadow-lg">
            <h3 class="font-bold text-gray-900 mb-2">âš–ï¸ Fault System</h3>
            <p class="text-lg font-semibold text-gray-800">{stateData.faultSystem}</p>
          </div>
          <div class="bg-white rounded-xl p-6 shadow-lg">
            <h3 class="font-bold text-gray-900 mb-2">ğŸš´ Passing Distance</h3>
            <p class="text-lg font-semibold text-gray-800">{stateData.passingDistance || '3 feet minimum'}</p>
          </div>
        </div>
      )}
      {stateData && (
        <div class="mt-8 text-center">
          <a href={`/states/${stateSlug}`} class="inline-flex items-center text-primary-600 hover:text-primary-700 font-semibold">
            View full {cityData.state} bicycle accident law guide â†’
          </a>
        </div>
      )}
    </div>
  </section>

  <section class="py-16 bg-white">
    <div class="container-wide">
      <h2 class="text-3xl md:text-4xl font-bold mb-8 text-gray-900">ğŸ›£ï¸ Dangerous Routes in {cityData.name}</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
        {cityData.dangerousRoutes.map((route) => (
          <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
            <div class="flex items-center gap-2">
              <span class="text-orange-500">ğŸ›£ï¸</span>
              <span class="font-medium text-gray-800">{route}</span>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  {stateCities.length > 0 && (
    <section class="py-16 bg-gray-100">
      <div class="container-wide">
        <h2 class="text-3xl font-bold mb-8 text-gray-900">Other {cityData.state} Cities We Serve</h2>
        <div class="grid md:grid-cols-3 lg:grid-cols-5 gap-4">
          {stateCities.map((city) => (
            <a href={`/cities/${city.slug}`} class="bg-white hover:bg-primary-50 rounded-lg p-4 border border-gray-200 hover:border-primary-300 transition text-center">
              <span class="font-medium text-gray-800 hover:text-primary-600">{city.name}</span>
            </a>
          ))}
        </div>
      </div>
    </section>
  )}

  <section class="py-16 bg-gradient-to-r from-primary-500 to-primary-600 text-white">
    <div class="container-wide text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-6">Injured While Cycling in {cityData.name}?</h2>
      <p class="text-xl mb-8 max-w-2xl mx-auto opacity-90">Don't let insurance companies take advantage of you. Get the compensation you deserve.</p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        
        <a href="#free-case-review" class="bg-gray-900 text-white font-bold py-4 px-8 rounded-lg hover:bg-gray-800 transition">Start Free Case Review</a>
      </div>
    </div>
  </section>
</BaseLayout>
